<?xml version="1.0" encoding="UTF-8"?>
<project name="connect" default="deploy" basedir=".">
    <target name="git_update_submodules">
        <exec executable="git" dir="${basedir}" failonerror="false">
            <arg value="submodule"/>
            <arg value="update"/>
            <arg value="--init"/>
            <arg value="--recursive"/>
        </exec>
    </target>

    <target name="update_asn" depends="git_update_submodules">
        <property name="branch" value="master"/>
        <exec executable="git" dir="${basedir}/protocol" failonerror="false">
            <arg value="pull"/>
        </exec>
        <property name="map.path" value="${basedir}/map.json"/>
        <exec executable="ant" dir="${basedir}/protocol" failonerror="true">
            <arg value="generate"/>
            <arg value="-Dbranch=${branch}"/>
        </exec>
        <delete file="${map.path}"/>
        <copy file="${basedir}/protocol/maps/json/Map.json" tofile="${map.path}"/>
    </target>
</project>
